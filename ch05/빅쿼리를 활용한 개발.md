<< 프로그래밍 방식을 활용한 개발 >>
-------

# 1. REST API
## 1.1. REST API?
  - [HTTP - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/HTTP)
  - [REST - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/REST)

## 1.2. REST API 사용
  - BigQuery API | Google Cloud
  - Cloud SDK 설치 : Quickstart: Getting started with Cloud SDK
  - GCP 인증 : Getting started with authentication
  - 샘플 api : Method: tables.list | BigQuery | Google Cloud
    - 인증정보 설정
      - Option 1 - Service Account Key Pair 사용
        ```Powershell
        set GOOGLE_APPLICATION_CREDENTIALS="looker-data-grfit-536efecf194c.json"
        ```
      - Option 2 - browser를 통한 login 인증
        ```Powershell
        gcloud auth application-default login
        ```
    - API 호출
    ```Powershell
    PROJECT=$(gcloud config get-value project)
    access_token=$(gcloud auth application-default print-access-token)
    curl -H "Authorization: Bearer $access_token" -H "Content-Type: application/json" -X GET "https://www.googleapis.com/bigquery/v2/projects/$PROJECT/datasets/pipelining_sample/tables"
    ```
    
## 1.3. REST API 대신 SQL 사용
  - 프로그래밍 대신 쿼리 이용하는 방법
  - SQL로 가능한 BigQuery 관련 정보들
    - CREATE / ALTER / DROP TABLE
    - INSERT / DELETE / UPDATE / MERGE
    - 데이터셋 메타데이터
      - INFORMATION_SCHEMA.SCHEMATA
      - INFORMATION_SCHEMA.SCHEMATA_OPTIONS
    - 테이블(뷰) 메타데이터
      - INVORMATION_SCHEMA.TABLES
      - INVORMATION_SCHEMA.TABLE_OPTIONS
      - INVORMATION_SCHEMA.COLUMNS
      - INVORMATION_SCHEMA.COLUMN_OPTIONS
    - 작업 메타데이터
      - NFORMATION_SCHEMA.JOBS_BY_USER
      - INFORMATION_SCHEMA.JOBS_BY_PROJECT
      - INFORMATION_SCHEMA.JOBS_BY_ORGANIZATION
    - 도구 사용과 숙련도 차원에서 SQL을 사용하는 것이 더 나은 경우도 많다..고 함
  - 쿼리를 API로 수행
    ```Powershell
    request.json 
    curl -H "Authorization: Bearer $access_token"   -H "Content-Type: application/json"   -X POST   -d @request.json   "https://www.googleapis.com/bigquery/v2/projects/$PROJECT/queries"
    ```
  - API 옵션(제약사항)
    ```json
    {
      "useLegacySql": false,
      "timeoutMs": 0,
      "useQueryCache": false,
      "query": \"${QUERY_TEXT}\"
    }
    ```

# 2. Google Cloud Client Library(with Python, Jupyter)
## 2.1. Python / Virtual Environment / Jupyter notebook 사용 환경 설정
https://purrfect-partridge-8ed.notion.site/ch-05-3792da53ec39411f8d629e1c269ea204
Python notebook 실습(With Jupyterlab)



# 3. 데이터 과학 도구에서 빅쿼리 다루기
jupyter magic(With Jupyterlab)
jupyter-lab에서 jupyter magic 키워드 사용 개발(%, %%)
Built-in magic commands — IPython 7.30.1 documentation
%load_ext : 클라이언트 라이브러리에서 bigquery magic 라이브러리 호출
%%bigquery : 쿼리 조회 및 결과를 Pandas Dataframe으로 반환
Visualizing BigQuery data in a Jupyter notebook | Google Cloud

R(With R Studio)
R 설치
The Comprehensive R Archive Network
Download the RStudio IDE
bigrquery 패키지 설치 및 라이브러리 적용
https://bigrquery.r-dbi.org/reference/index.html
Service Account Key 설정
https://bigrquery.r-dbi.org/reference/bq_auth.html
bigquery project 설정 및 데이터 활용

Dataflow(with VS Code)
Apache Beam : An advanced unified programming model
Dataflow(Fully-Managed)에 기반이 되는 apache beam SDK를 이용
apache-beam[gcp] 패키지 설치
https://beam.apache.org/get-started/quickstart-py/
Runner : 분산처리 백엔드 엔진 : Dataflow 활용
RUNNER = 'DataflowRunner'


beam pipeline : 데이터 추출 -> 원하는 데이터 형태로 변형 -> 결과 데이터 다시 입력
source
SELECT chapter, title FROM pipelining_sample.db_dataflow_test
destination
SELECT chapter, title FROM bq_lib_ch05_jsyoo.temp_table

참고 : [GCP] Apache Beam 알아보기
※ 기타 : python 3.8 버전에서 apache-beam 라이브러리 설치 원활

jdbc / odbc driver
Java 혹은 .Net에서 사용하는 Database Connection API(Connection String)
ODBC and JDBC drivers for BigQuery | Google Cloud
여러 연결 방법 중 odbc data source administrator 에서 설정 후 적용하는 방법(dsn connection string 방법 등 존재)
ODBC 설치(32bit)
ODBC Data Source Administrator 에서 인증 키 설정
사용할 프로그램에서 설정

google apps script
bigquery 데이터를 workspace에 연동하여 개발 수행
Script Google
bigquery project 설정
bigquery 서비스 포함
BigQuery Service | Apps Script | Google Developers

bq command line
Google Cloud SDK(Software Development Kit)에서 제공하는 도구이며, CLI(Command Line Interface)에서 빅쿼리 작업 수행 가능
SDK는 Google Cloud VM(Compute Engine)과 Cluster에 기본 설치되어 있고, on-premises에서는 다운받아 설치 후 수행 가능
BigQuery 콘솔 UI에서 수행할 수 있는 모든 작업들 수행 가능(당연히..)
Using the bq command-line tool | BigQuery | Google Cloud
bq command-line tool reference | BigQuery | Google Cloud

기타
※ key.json 파일은 github 등을 사용할 때 public으로 올려놓게 되면 매우 위험하므로 주의 필요!
